<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>To-Do App</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet">
        <link rel="stylesheet" href="styles.css">
    </head>

    <body>

        <div class="container">
            <!-- HEADING -->
            <div class="heading">
                <p class="main-heading">Your To-Do list</p>
                <p class="subheading">Let's see what we've got today.</p>
            </div>

            <!-- TASKS -->


            <!-- EMPTY TASKS FALLBACK -->
            <p class="empty-tasks">You don't have tasks to do yay!</p>

            <!-- INPUT CONTAINER -->
            <div class="input-container">
                <textarea name="inputTask" id="inputTask" placeholder="What do you need to do?" rows="4"></textarea>
                <div class="button-container">
                    <button onclick="addTask()">Add Task</button>
                </div>
            </div>

        </div>

        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
        <script>
            const defaultTask = ['Sample Checkbox 1', 'Sample Checkbox 2']
            const container = document.querySelector(".container");
            const inputContainer = document.querySelector(".input-container");

            defaultTask.forEach((item, index) => {
                addTaskToStorage("task-" + index, item);
            });

            for (let i = 0; i < localStorage.length; i++) {
                const keys = localStorage.key(i);
                if (keys.startsWith("task-")) {
                    createTaskContainer(keys, localStorage.getItem(keys));
                }
            }

            function addTask() {
                const inputValue = document.getElementById("inputTask").value;
                if (inputValue.length == 0) {
                    alert("Please input a value.");
                    return;
                }
                document.getElementById("inputTask").value = "";

                const taskId = "task-" + generateTimestampId();
                createTaskContainer(taskId, inputValue);
                addTaskToStorage(taskId, inputValue);
            }

            function createTaskContainer(taskId, inputValue) {
                const taskContainer = document.createElement("div");
                taskContainer.className = "task-container";

                const taskDiv = document.createElement("div");

                const taskInput = document.createElement("input");
                taskInput.type = "checkbox";
                taskInput.id = taskId;
                taskInput.name = taskInput.id;
                const taskLabel = document.createElement("label");
                taskLabel.htmlFor = taskInput.id;
                taskLabel.innerText = inputValue;

                taskDiv.append(taskInput);
                taskDiv.append(taskLabel);

                const deleteButton = document.createElement("button");
                deleteButton.className = "delete-button";
                deleteButton.onclick = () => deleteTaskContainer(taskInput.id);
                const deleteIcon = document.createElement("ion-icon");
                deleteIcon.className = "delete-icon";
                deleteIcon.name = "trash-outline";

                deleteButton.append(deleteIcon);

                taskContainer.append(taskDiv);
                taskContainer.append(deleteButton);

                container.insertBefore(taskContainer, inputContainer);
            }

            function deleteTaskContainer(taskInputId) {
                if (!confirm("Are you sure you want to delete this task?")) return;
                const taskElement = document.getElementById(taskInputId).parentElement.parentElement;
                taskElement.remove();

                removeTaskToStorage(taskInputId)
            }

            function addTaskToStorage(taskInputKey, inputValue) {
                localStorage.setItem(taskInputKey, inputValue);
            }

            function removeTaskToStorage(taskInputKey) {
                localStorage.removeItem(taskInputKey);
            }

            function generateTimestampId() {
                return Date.now().toString();
            }
        </script>
    </body>

</html>